// Generated by CoffeeScript 1.4.0
(function() {

  jQuery(function($) {
    var match;
    $("#editor").disableSelection().sortable({
      items: "> li.widget",
      update: function(e, ui) {
        return $("#editor > li.widget").each(function(i) {
          return $(this).data('model').setPosition(i);
        });
      }
    });
    $('#about-form').showForm();
    window.widgetMap = {
      custom: {
        model: CustomWidget,
        view: CustomView
      },
      image: {
        model: ImageWidget,
        view: ImageView
      },
      list: {
        model: ListWidget,
        view: ListView
      },
      quote: {
        model: QuoteWidget,
        view: QuoteView
      },
      status: {
        model: StatusWidget,
        view: StatusView
      }
    };
    $('*[title]').tipsy({
      gravity: 'n'
    });
    match = location.href.match(/\/edit\/(\d+)/);
    if (match) {
      return $.getJSON('/object/' + match[1] + '/', function(report) {
        var block, data, _i, _len, _ref;
        $('#about-form input[name=name]').val(report.name).change();
        $('#about-form input[name=email]').val(report.user.email).change();
        $('#report-date').trigger('set-date', [new Date(report.date_from), new Date(report.date_to)]);
        _ref = report.blocks;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          block = _ref[_i];
          data = block.data;
          delete block.data;
          $.extend(data, block);
          addWidget(block.type, data);
        }
        return null;
      });
    } else {
      addWidget('custom', {
        data: 'Click',
        name: 'to edit data block'
      });
      return addWidget('custom', {
        data: 'Drag',
        name: 'block to re-arrange'
      });
    }
  });

}).call(this);
